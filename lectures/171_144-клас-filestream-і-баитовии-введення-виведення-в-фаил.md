---
layout: default
title: "14.4 Клас FileStream і байтовий введення-виведення в файл"
---

# 14.4 Клас FileStream і байтовий введення-виведення в файл

У середовищі .NET Framework передбачені класи для організації введення-виведення в файли. Безумовно, це в основному файли дискового типу. На рівні операційної системи файли мають байтову організацію. І, як очікувалося, для введення і виведення байтів в файли є відповідні методи. Тому введення і виведення в файли байтовими потоками досить поширене. Крім того, байтовий потік вво ду або виведення в файл може бути укладений в відповідний об'єкт символьного потоку. Операції символьного введення-виведення в файл знаходять застосування при обра ботці тексту . Про символьні потоки буде розповідатися далі в цьому розділі, а тут розглядається байтовий введення-виведення. Для створення байтового потоку, пов'язаного з файлом, використовується клас FileStream . Цей клас є похідним від класу Stream і успадковує всі його функції. Нагадаємо, що класи потоків, включаючи FileStream , визначені в просторі імен System.IO . Тому на початку будь-якої програми, яка використовує їх, зазвичай вводиться наступний рядок коду. using System.IO;

Для формування байтового потоку, пов'язаного з файлом, створюється об'єкт класу FileStream . У цьому класі визначено кілька конструкторів. Нижче наведений, мабуть, найпоширеніший з них:

FileStream(string шлях, FileMode режим)

де шлях означає ім'я відкриваного файлу, включаючи повний шлях до нього; а режим — порядок відкриття файлу. У останньому випадку вказується одне зі значень, визначених у перерахуванні FileMode і наведених у табл. 14.4. Зазвичай, цей конструктор відкриває файл для доступу з метою читання або запису. Винятком з цього правила є відкриття файлу в режимі FileMode.Append , коли файл стає доступним тільки для запису.

Малюнок 14.7 - Значення з переліку FileMode

Якщо спроба відкрити файл виявляється невдалим, то генерується виняток. Якщо файл неможливо відкрити через те, що він не існує, генерується виняток FileNotFoundException. А якщо файл неможливо відкрити через яку- небудь помилку введення-виведення, то генерується виняток IOException. До чис ла інших винятків, які можуть бути згенеровані при відкритті файлу, відносяться наступні: ArgumentNullException (вказано порожнє ім'я файлу), ArgumentException (вказано невірне ім'я файлу), ArgumentOutOfRangeException (вказано невірний режим), SeaurityException (у користувача немає прав доступу до файлу), PathTooLongException (занадто довге ім'я файлу або шлях до нього), NotSupportedException (у імені файлу вказано пристрій, який не підтримується), а також DirectoryNotFoundException (вказано невірний каталог). Виключення PathTooLongException, DirectoryNotFoundException іFileNotFoundException належать до підкласів класу виключеньIOException. Тому всі вони можуть бути перехоплені, якщо перехоплюється виключення IOException.

Лістинг 14.01 - Нижче наведено один з способів відкриття файлу test.dat для вводу

FileStream fin;

try

{

fin = new FileStream("test", FileMode.Open);

}

catch (IOException exc)

{ // перехопити всі виключення, пов'язані з введеннямвиведенням

Console.WriteLine(exc.Message);

// Обробити помилку.

}

catch (Exception exc { // перехопити будь-яке інше виключення.

Console.WriteLine(exc.Message);

// Обробити помилку, якщо це можливо.

// Ще раз згенерувати неперехоплені виключення.

}

У першому блоку catch з цього прикладу обробляються помилки, що виникають у випадку, якщо файл не знайдено, шлях до нього занадто довгий, каталог не існує та інші помилки введення-виведення. У другому блоку catch , який є " універсальним " для всіх інших типів виключень, обробляються інші ймовірні помилки (можливо, навіть шляхом повторного генерування виключення). Крім того, кожну помилку можна перевірити окремо, повідомляючи більш детально про неї та приймаючи конкретні заходи щодо її виправлення. З метою спрощення прикладів, наведених у цій книзі, перехоплюється тільки виняток IOException , але у реальній програмі, ймовірно, знадобиться перехоплювати інші можливі винятки, пов'язані з введенням-виведенням, залежно від обставин. Крім того, у обробниках винятків, наведених у цьому розділі, просто повідомляється про помилку, але часто в них повинні бути запрограмовані конкретні заходи щодо виправлення помилок, якщо це взагалі можливо. Наприклад, можна запропонувати користувачеві знову ввести ім'я файлу, якщо раніше вказаний файл не був знайдений . Можливо, також знадобиться знову згенерувати виняток.
