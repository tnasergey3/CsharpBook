---
layout: default
title: "9.6 Оператори перетворення"
---

# 9.6 Оператори перетворення

Іноді об'єкт певного класу потрібно використовувати в виразі, що включає дані інших типів. У деяких випадках для цієї цілі виявляється придатна перевантаження одного або більше операторів, а в інших випадках — звичайне перетворення типу класу в цільовий тип. Для подібних ситуацій в C# передбачена спеціальна різновидність операторного методу, називана оператором перетворення. Такий оператор перетворює об'єкт вихідного класу в інший тип. Оператори перетворення допомагають повністю інтегрувати типи класів у середовище програмування на C#, дозволяючи вільно користуватися класами разом з іншими типами даних, за умови, що визначений порядок перетворення в ці типи. Існують дві форми операторів перетворення: явна і неявна. Нижче вони представлені у загальному вигляді:

public static explicit operator цільовий_тип(вихідний_тип v) {return значення ;}

public static implicit operator цільовий_тип(вихідний_тип v) {return значення ;}

де цільовий_тип означає той тип, в який виконується перетворення; вхідний_тип — той тип, який перетворюється; значення — конкретне значення, що набуває клас після перетворення. Оператори перетворення повертають дані, що мають цільовий_ тип , причому вказувати інші повернуті типи даних не дозволяється. Якщо оператор перетворення вказаний у неявній формі ( implicit ), то перетворення викликається автоматично, наприклад, у випадку, коли об'єкт використовується у виразі разом із значенням цільового типу. Якщо ж оператор перетворення вказаний у явній формі ( explicit ), то перетворення викликається у випадку, коли виконується приведення типів. Для одних і тих же вихідних і цільових типів даних не можна вказувати оператор перетворення одночасно у явній і неявній формі. Створимо оператор перетворення спеціально для класу ThreeD, щоб проде монструвати його застосування. Припустимо, що потрібно перетворити об'єкт типу ThreeD в ціле значення, щоб потім використовувати його в цілочисельному виразі. Таке перетворення потрібне, зокрема, для отримання добутку всіх трьох координат об'єкта. З цією метою ми скористаємося наступною неявною формою опе ратора перетворення.

Лістинг 9.6 - Приклад застосування оператора неявного перетворення.

using System;

// Клас для зберігання тривимірних координат.

class ThreeD

{

int х, у, z; // тривимірні координати

public ThreeD() { x = y = z = 0; }

public ThreeD(int i, int j, int k) { x = i; y = j; z = k; }

// Перевантажити бінарний оператор +.

public static ThreeD operator +(ThreeD op1, ThreeD op2)

{

ThreeD result = new ThreeD();

result.x = op1.x + op2.x;

result.у = op1.у + op2.y;

result.z = op1.z + op2.z;

return result;

}

// Неявне перетворення об'єкта типу ThreeD до типу int.

public static implicit operator int(ThreeD op1)

{

return op1.x * op1.у * op1.z;

}

// Вивести координати X, Y, Z.

public void Show()

{

Console.WriteLine(x + ", " + y + ", " + z);

}

}

Як випливає з наведеного вище прикладу програми, коли об'єкт типу ThreeD використовується в цілочисельному виразі, такому як i = а , відбувається його перетворення. У цьому конкретному випадку перетворення призводить до повернення цілого значення 6 , яке є добутком координат точки а , що зберігаються в об'єкті з такою самою назвою. Але якщо для обчислення виразу не потрібне перетворення в тип int , то оператор перетворення не викликається. Саме тому операторний метод operator int() не викликається при обчисленні виразу с = а + b . Але для різних цілей можна створити різні оператори перетворення. Так, для перетворення об'єкта типу ThreeD в тип double можна було б визначити другий оператор перетворення. При цьому кожен вид перетворення виконувався автоматично і незалежно від іншого.
